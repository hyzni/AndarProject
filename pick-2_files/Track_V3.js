(function(){"use strict";var DS={win:window,winLs:window.localStorage,winLsJsonValue:{},doc:document,nav:navigator,isFirstVisit:"n",isFirstCampaignVisit:"n",protocolRegExp:new RegExp("^http://|https://|'","i"),logType:"Pageview|Event|AddToCart|Purchase|AddToWishlist|Search|Registration|Contact|Consultation",logServer:"clickstream.edisonoptimizer.com",cookieDays:365*24*60*60*2,toDayTime:(new Date).getTime(),isEtsParam:false,isPageViewSend:false,arrParamNm:["ets_id","ets_source","ets_medium","ets_campaign","ets_group","ets_term","ets_content","utm_source","utm_source","utm_medium","utm_campaign","utm_group","utm_term","utm_content"],setLogServer:function(obj){if(!UTIL.isNullEmpty(obj)&&obj=="dev"){this.logServer="clickstream-dev.edisonoptimizer.com"}},Ul:function(){return this.doc.location.href},Rf:function(){return this.doc.referrer},Ulp:function(){return this.doc.location.search},BrowLanguage:function(){return this.win.navigator.language||this.win.navigator.userLanguage||this.win.navigator.systemLanguage||this.win.navigator.browserLanguage},Screen:function(){return screen.width+" x "+screen.height},Charset:function(){return this.doc.characterSet||this.doc.charset},Protocol:function(){return this.win.location.protocol},BrowChk:function(){return/Chrome/.test(this.nav.userAgent)&&!/Edge|Android/.test(this.nav.userAgent)}};var COOKIE={set:function(Ec,Ed,Ee,Ef,Eg,Et){var dt=new Date;var pt="";Ee=!Ee?"/":Ee;if(Ed===null)Eg=0;if(Eg!=null){dt.setTime(DS.toDayTime+Eg*1e3);if(!UTIL.isNullEmpty(Et)){dt.setTime(parseInt(Et)+Eg*1e3)}pt=" expires="+dt.toUTCString()+";"}if(Ef!=null)pt+=" domain="+Ef+";";DS.doc.cookie=DS.cookieNamePrefix+Ec+"="+encodeURIComponent(Ed)+"; path="+Ee+";"+pt+"SameSite=Strict"},get:function(Ec){var cookieKey=DS.cookieNamePrefix+Ec;var regex=new RegExp(DS.aid,"i");if(regex.test(Ec)||Ec=="CVID_Y"){cookieKey=Ec}var RT=DS.doc.cookie.match("(^|;) ?"+cookieKey+"=([^;]*)(;|$)");if(RT)return decodeURIComponent(RT[2]);else return""}};var URI={getParam:function(PNm){var PVal="";if(DS.Ulp()&&DS.Ulp()!=""){var PUrl=DS.Ulp().substring(1);var ArrParam=PUrl.split("&");var arrParNm,i;var ArrParamLength=ArrParam.length;for(i=0;i<ArrParamLength;i++){arrParNm=ArrParam[i].split("=");if(arrParNm[0].toUpperCase()===PNm.toUpperCase()){PVal=arrParNm[1];break}}}return PVal},getDomain:function(Ul){var Url=Ul.replace(DS.protocolRegExp,"");if(Url.indexOf(":")>-1){Url=Url.substring(0,Url.indexOf(":"))}if(Url.indexOf("/")>-1){Url=Url.substring(0,Url.indexOf("/"))}var arr=Url.split(".");var arrLength=arr.length;if(arrLength==3){if(arr[1].length==2||arr[1]=="com"){return Url}else{return arr[1]+"."+arr[2]}}else if(arrLength>3){if(arr[arrLength-2].length==2||arr[arrLength-2]=="com"){return arr[arrLength-3]+"."+arr[arrLength-2]+"."+arr[arrLength-1]}else{return arr[arrLength-2]+"."+arr[arrLength-1]}}else{return Url}}};var UTIL={getId:function(){var d=(new Date).getTime();var idCode="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx";var uuid=idCode.replace(/[xy]/g,function(c){var r=(d+Math.random()*16)%16|0;d=Math.floor(d/16);var idCodeSet=c==="x"?r:r&7|8;return idCodeSet.toString(16)});return uuid.replace(/-/g,"")},getIsund:function(para,str){if(this.isNullEmpty(str)){return""}else if(!str){return""}else{return para+str}},convPramToJson:function(param){var returnObjResult={};if(typeof param!=="string"||param==undefined||param==null|param==""){return{}}var pairs=param.split("&");for(const pair of pairs){const[key,value]=pair.split("=");if(!key||!value){continue}returnObjResult[key]=value}return returnObjResult},convJsonToParam:function(jsonObj){return Object.keys(jsonObj).map(function(key){return key+"="+jsonObj[key]}).join("&")},setSendChk:function(msecs){var start=(new Date).getTime();var cur=start;while(cur-start<msecs){cur=(new Date).getTime()}},setJson:function(){window.JSON={stringify:function(){var toString=Object.prototype.toString;var isArray=Array.isArray||function(a){return toString.call(a)==="[object Array]"};var escMap={'"':'\\"',"\\":"\\\\","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t"};var escFunc=function(m){return escMap[m]||"\\u"+(m.charCodeAt(0)+65536).toString(16).substr(1)};var escRE=/[\\"\u0000-\u001F\u2028\u2029]/g;return function stringify(value){if(value==null){return"null"}else if(typeof value==="number"){return isFinite(value)?value.toString():"null"}else if(typeof value==="boolean"){return value.toString()}else if(typeof value==="object"){if(typeof value.toJSON==="function"){return stringify(value.toJSON())}else if(isArray(value)){var res="[";for(var i=0;i<value.length;i++)res+=(i?", ":"")+stringify(value[i]);return res+"]"}else if(toString.call(value)==="[object Object]"){var tmp=[];for(var k in value){if(value.hasOwnProperty(k))tmp.push(stringify(k)+": "+stringify(value[k]))}return"{"+tmp.join(", ")+"}"}}return'"'+value.toString().replace(escRE,escFunc)+'"'}}()}},setLocalStorageSupported:function(){try{var supportKey="support",storage=DS.winLs;storage.setItem(supportKey,"true");storage.removeItem(supportKey);DS.winLsSupported=true}catch(error){DS.winLsSupported=false}},is2YearsPast:function(storedTime){var timeDifference=DS.toDayTime-storedTime;return timeDifference>=DS.cookieDays*1e3},isNullEmpty:function(value){if(value===""||value==="undefined"){return true}if(value===null||value===undefined){return true}return false}};var SETTING={setDataFromCookie:function(v2CookieName){DS.cid=COOKIE.get("cid");DS.firstVisitDate=COOKIE.get("fvdt");DS.firstCampaignDate=COOKIE.get("fcvdt");DS.lastCampaignDate=COOKIE.get("lcvdt");DS.v2Cid=COOKIE.get(v2CookieName+"CID");if(DS.winLsSupported){DS.winLsJsonValue=UTIL.convPramToJson(DS.winLs.getItem(DS.cookieNamePrefix));DS.lsCid=DS.winLsJsonValue["cid"];DS.lsFirstCampaignDate=DS.winLsJsonValue["fcvdt"];DS.lsFirstVisitDate=DS.winLsJsonValue["fvdt"];DS.lsLastCampaignDate=DS.winLsJsonValue["lcvdt"]}DS.cvidY=COOKIE.get("CVID_Y")},setPageViewSend:function(ul,rl){var nowDomain=URI.getDomain(ul);var referrerDomain=URI.getDomain(rl);if(nowDomain!==referrerDomain){DS.isPageViewSend=true}},setCampaignParam:function(){var i;var arrParamNmLength=DS.arrParamNm.length;for(i=0;i<arrParamNmLength;i+=1){if(URI.getParam(DS.arrParamNm[i])!=""){DS.isEtsParam=true;break}}},setVisitType:function(rfDomain,ulDomain){if(!UTIL.isNullEmpty(rfDomain)){if(ulDomain!==rfDomain&&DS.isEtsParam){DS.visitType="AdInflow"}else if(ulDomain===rfDomain&&DS.isEtsParam){DS.visitType="IntoReInflow"}else if(ulDomain===rfDomain){DS.visitType="IntoInflow"}else{DS.visitType="LinkInflow"}}else{DS.visitType="DirInflow"}},createCookie:function(ulDomain){if(UTIL.isNullEmpty(DS.cid)||UTIL.isNullEmpty(DS.firstVisitDate)){var targetDate=undefined;DS.cid=UTIL.getId();DS.firstVisitDate=DS.toDayTime;DS.isFirstVisit="y";if(!UTIL.isNullEmpty(DS.firstCampaignDate)){DS.firstCampaignDate=undefined;COOKIE.set("fcvdt",DS.cid,"/",ulDomain,-1)}if(!UTIL.isNullEmpty(DS.lastCampaignDate)){DS.lastCampaignDate=undefined;COOKIE.set("lcvdt",DS.cid,"/",ulDomain,-1)}if(!UTIL.isNullEmpty(DS.lsCid)){if(!UTIL.isNullEmpty(DS.lsFirstCampaignDate)&&!UTIL.is2YearsPast(DS.lsFirstCampaignDate)||UTIL.isNullEmpty(DS.lsFirstCampaignDate)&&!UTIL.is2YearsPast(DS.lsFirstVisitDate)){DS.cid=DS.lsCid;DS.firstVisitDate=DS.lsFirstVisitDate;targetDate=DS.lsFirstVisitDate;if(!UTIL.isNullEmpty(DS.lsFirstCampaignDate)){targetDate=DS.lsFirstCampaignDate;DS.firstCampaignDate=DS.lsFirstCampaignDate;COOKIE.set("fcvdt",DS.firstCampaignDate,"/",ulDomain,DS.cookieDays,targetDate);if(!UTIL.isNullEmpty(DS.lsLastCampaignDate)){DS.lastCampaignDate=DS.lsLastCampaignDate;COOKIE.set("lcvdt",DS.lastCampaignDate,"/",ulDomain,DS.cookieDays,targetDate)}}DS.isFirstVisit="n"}else{DS.lsCid=DS.cid;DS.lsFirstVisitDate=DS.firstVisitDate;DS.lsFirstCampaignDate=undefined;DS.lsLastCampaignDate=undefined}}else{DS.lsCid=DS.cid;DS.lsFirstVisitDate=DS.firstVisitDate;if(!UTIL.isNullEmpty(DS.firstCampaignDate)){DS.lsFirstCampaignDate=DS.firstCampaignDate}if(!UTIL.isNullEmpty(DS.lastCampaignDate)){DS.lsLastCampaignDate=DS.lastCampaignDate}}COOKIE.set("cid",DS.cid,"/",ulDomain,DS.cookieDays,targetDate);COOKIE.set("fvdt",DS.firstVisitDate,"/",ulDomain,DS.cookieDays,targetDate)}else{if(UTIL.isNullEmpty(DS.lsCid)){DS.lsCid=DS.cid;DS.lsFirstVisitDate=DS.firstVisitDate;if(!UTIL.isNullEmpty(DS.firstCampaignDate)){DS.lsFirstCampaignDate=DS.firstCampaignDate}if(!UTIL.isNullEmpty(DS.lastCampaignDate)){DS.lsLastCampaignDate=DS.lastCampaignDate}}}if(DS.isEtsParam){if(UTIL.isNullEmpty(DS.firstCampaignDate)){DS.isFirstCampaignVisit="y";DS.firstCampaignDate=DS.toDayTime;DS.lsFirstCampaignDate=DS.toDayTime;COOKIE.set("fcvdt",DS.firstCampaignDate,"/",ulDomain,DS.cookieDays);COOKIE.set("cid",DS.cid,"/",ulDomain,DS.cookieDays);COOKIE.set("fvdt",DS.firstVisitDate,"/",ulDomain,DS.cookieDays)}DS.lastCampaignDate=DS.toDayTime;DS.lsLastCampaignDate=DS.toDayTime;COOKIE.set("lcvdt",DS.lastCampaignDate,"/",ulDomain,DS.cookieDays,DS.firstCampaignDate)}}};var LOG={basic:function(){DS.cookieNamePrefix="_pa_"+DS.aid+"_";var v2CookieName=DS.aid+"_";var rlUrl=DS.Rf();var ulUrl=DS.Ul();var rfDomain=URI.getDomain(rlUrl);var ulDomain=URI.getDomain(ulUrl);UTIL.setLocalStorageSupported();SETTING.setDataFromCookie(v2CookieName);SETTING.setPageViewSend(ulUrl,rlUrl);SETTING.setCampaignParam();SETTING.setVisitType(rfDomain,ulDomain);SETTING.createCookie(ulDomain);if(DS.winLsSupported){DS.winLsJsonValue["cid"]=DS.lsCid;DS.winLsJsonValue["fvdt"]=DS.lsFirstVisitDate;if(!UTIL.isNullEmpty(DS.lsFirstCampaignDate)){DS.winLsJsonValue["fcvdt"]=DS.lsFirstCampaignDate}if(!UTIL.isNullEmpty(DS.lsLastCampaignDate)){DS.winLsJsonValue["lcvdt"]=DS.lsLastCampaignDate}DS.winLs.setItem(DS.cookieNamePrefix,UTIL.convJsonToParam(DS.winLsJsonValue))}},send:function(obj){var type=obj[1];var val=obj.length>2?JSON.stringify(obj[2]):undefined;var url="//"+DS.logServer+"/?ac="+DS.aid+"&ul="+encodeURIComponent(DS.Ul())+UTIL.getIsund("&rl=",encodeURIComponent(DS.Rf()))+UTIL.getIsund("&vt=",DS.visitType)+UTIL.getIsund("&fv=",DS.isFirstVisit)+UTIL.getIsund("&fcv=",DS.isFirstCampaignVisit)+"&fvdt="+DS.firstVisitDate+UTIL.getIsund("&fcvdt=",DS.firstCampaignDate)+UTIL.getIsund("&lcvdt=",DS.lastCampaignDate)+"&cid="+DS.cid+UTIL.getIsund("&v2cid=",DS.v2Cid)+UTIL.getIsund("&cvidy=",encodeURIComponent(DS.cvidY))+"&ty="+type+UTIL.getIsund("&val=",encodeURIComponent(val))+"&lan="+DS.BrowLanguage()+"&scn="+DS.Screen()+"&cs="+DS.Charset()+"&vr=8.0.1"+"&ck="+(new Date).getTime();try{var eLogxhr;if(DS.Protocol()=="https:"&&DS.BrowChk()){eLogxhr=new XMLHttpRequest;eLogxhr.open("GET",DS.Protocol()+url,true);eLogxhr.setRequestHeader("content-type","text/plain");eLogxhr.send(null)}else{eLogxhr=new Image;eLogxhr.src=url;UTIL.setSendChk(300)}}catch(e){console.log(e)}}};var push=function(obj){switch(obj[0]){case"init":DS.aid=obj[1];DS.setLogServer(obj[2]);LOG.basic();break;case"send":if(new RegExp(obj[1],"i").test(DS.logType)){if(obj[1]!=="Pageview"){DS.visitType=undefined;DS.isFirstVisit=undefined;DS.isFirstCampaignVisit=undefined}if(obj[1]==="Search"){var searchP=obj[2].searchParameter;if(searchP){obj[2].searchKeyword=URI.getParam(searchP)}}if(obj[1]==="Purchase"){if(obj[2].price){var price=obj[2].price;delete obj[2].price;obj[2].total_price=price}}if(obj[1]=="Pageview"){if(DS.isEtsParam||DS.isPageViewSend){LOG.send(obj)}}else{LOG.send(obj)}}break;default:break}};var init=function(){if(!window.JSON){UTIL.setJson()}var i;var qu=DS.win.pa.queue;var quLen=qu.length;for(i=0;i<quLen;i++){push(qu[i])}try{Object.defineProperty(qu,"push",{value:push})}catch(e){qu.push=push}};init();if(typeof module!=="undefined"&&module.exports){module.exports={COOKIE:COOKIE,UTIL:UTIL,URI:URI,DS:DS,SETTING:SETTING,LOG:LOG}}})();